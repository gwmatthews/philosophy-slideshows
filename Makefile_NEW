HANDOUT_DIR=${./pdf}
SRC=${filter-out ${wildcard *-src.Rmd}, ${wildcard *.Rmd}}
HTML=${patsubst %.Rmd, %.html, ${SRC}}
# PDF=${patsubst %.html, %.pdf, ${HTML}}
WEB=${filter-out ${wildcard *-Print.html}, ${HTML}}
DOWNLOAD_PDF=${patsubst %.html, %.pdf, ${WEB}}
PRINT=${filter ${wildcard *-Print.html}, ${HTML}}
PRINT_PDF=${patsubst %.html, %.pdf, ${PRINT}}
HANDOUT=${patsubst %.tex, %.pdf, ${wildcard *.tex}}

.PHONY : all
all : ${DOWNLOAD_PDF} ${HANDOUT}

%.html : %.Rmd 
	R -e 'rmarkdown::render("$<", output_file = "$@")'

%.pdf : %.html 
	R -e 'pagedown::chrome_print("$<", "$@")'

%-print.pdf : %-print.tex
	pdflatex -output-directory ${HANDOUT_DIR} $< 

cleanup :
	rm -f ./*-Print.pdf
	rm -f ./*-Print.html
	rm -f ./*.aux
	rm -f ./*.log

clean :
	rm -f ./*.html
	rm -f ./*.pdf
	rm -f ./pdf/*.pdf

.INTERMEDIATE : ${PRINT} ${PRINT_PDF}

